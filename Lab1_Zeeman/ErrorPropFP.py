import numpy as np
from matplotlib import pyplot as plt

def err(B,errB,dist,h,c,t): #add herr and cerr as params eventually
	#We retrieve the error on the distance
	disterr=dist[:,2]
	#We retrieve the distance
	rsq=dist[:,1]**2
	#we propagate the error on r^2
	rsqerr=4*rsq*disterr**2


	delta=0
	deltaerr=0
	for i in range(4):
		delta+=rsq[2*i+1]-rsq[2*i]
		deltaerr+=rsqerr[2*i+1]+rsqerr[2*i] #this is the variance squared
	delta*=0.25
	

	triangle=0
	triangleerr=0
	for i in range(2):
		triangle+=rsq[4*i+3]-rsq[4*i+1]+rsq[4*i+2]-rsq[4*i]
		triangleerr+=rsqerr[4*i+3]+rsqerr[4*i+1]+rsqerr[4*i+2]+rsqerr[4*i] #this is the variance squared

	triangle*=0.25

	delV=delta/(2*t*triangle)
	delVerr=deltaerr/((2*t*triangle)**2)+((delta/(2*t*triangle**2))**2)*triangleerr
	magneton=h*c*0.5*delV/B
	magnetonerr=((h*c*delV/(2*B**2))**2)*errB**2
	magnetonerr+=((h*c/(2*B))**2)*delVerr
	#Add uncertainties caused by c&h
	#magnetonerr+=((c*delV/(2*B))**2)*herr**2
	#magnetonerr+=((h*delV/(2*B))**2)*cerr**2
	magnetonerr=np.sqrt(magnetonerr)
	return magneton, magnetonerr

c=299792458
h=6.62607004*10**(-34)
dist1=np.array(
 [[1663.55470314,329.44529686,85.81980428],
 [1443.48132088,549.51867912,38.54966208],
 [1339.44663109,653.55336891,100.],
 [1143.38125417,849.61874583,32.96744554],
 [1049.34989993,943.65010007,27.61399121],
 [ 887.29586391,1105.70413609,100.],
 [ 742.24749833,1250.75250167,11.41401506],
 [ 686.22881921,1306.77118079,21.23387344]])
#[ 515.17178119,1477.82821881,99.99998291]])

dist2=np.array(
[[1291.32291146,320.67708854,47.60205374],
#[1159.45027815,452.54972185,100.],
 [1156.28914457,455.71085543,42.42018523],
 [1035.25887944,576.74112056,37.81107085],
 [ 920.23011506,691.76988494,39.63215945],
 [ 738.1845923,873.8154077,59.59710739],
 [ 519.12981491,1092.87018509,100.],
 [ 325.08129065,1286.91870935,44.66238056],
 [ 250.6726549,1361.3273451,43.05652429],
 [ 140.03501751,1471.96498249,70.71310064]])

dist3=np.array([
#[1.28042266e+03,7.13577340e+02 1.00000000e+02],
 [1.27942662e+03,7.14573382e+02,6.05922620e+01],
#[1.27138742e+03,7.22612582e+02,1.00000000e+02],
#[1.25570967e+03,7.38290326e+02,1.00000000e+02],
#[1.19740568e+03,7.96594322e+02,1.00000000e+02],
#[1.16584244e+03,8.28157560e+02,9.37643847e+01],
#[1.14962736e+03,8.44372644e+02,6.23975305e+00],
 [1.14738259e+03,8.46617412e+02,1.63114213e+01],
#[1.13066725e+03,8.63332749e+02,8.99280764e+01],
#[1.11577770e+03,8.78222300e+02,1.00000000e+02],
 [1.04834957e+03,9.45650434e+02,3.91709346e+01],
 [9.70323549e+02,1.02367645e+03,8.45533948e+00],
#[9.16105278e+02,1.07789472e+03,1.00000000e+02],
#[9.06334908e+02,1.08766509e+03,8.26397326e+00],
#[8.90296865e+02,1.10370314e+03,2.04495354e+01],
#[8.67823257e+02,1.12617674e+03,1.00000000e+02],
 [8.52756671e+02,1.14124333e+03,7.76698657e+00],
#[8.43047763e+02,1.15095224e+03,1.00000000e+02],
#[8.26275517e+02,1.16772448e+03,1.45762394e+00],
#[8.03637513e+02,1.19036249e+03,1.00000000e+02],
 [7.49249833e+02,1.24475017e+03,1.98116352e+00],
#[7.17314454e+02,1.27668555e+03,1.00000000e+02],
 [6.93231154e+02,1.30076885e+03,6.54498728e+01],
#[6.83313034e+02,1.31068697e+03,1.00000000e+02],
#[6.80775519e+02,1.31322448e+03,1.00000000e+02],
#[6.65585738e+02,1.32841426e+03,1.00000000e+02],
#[5.74205874e+02,1.41979413e+03,1.00000000e+02],
 [5.45521266e+02,1.44847873e+03,1.16638697e+01],
 [5.25175117e+02,1.46882488e+03,6.34426189e+01]])
dist4=np.array([
 [1352.45096731,641.54903269,38.64553975],
 [1137.37925284,856.62074716,4.56564158],
#[1071.97084626,922.02915374,100.],
 [1051.35056704,942.64943296,11.15464697],
 [961.6009604 ,1032.3990396,100.],
 [895.69091434,1098.30908566,88.70522379],
 [878.29286191,1115.70713809,18.23089292],
 [716.23882588,1277.76117412,89.48222584],
 [519.17311541,1474.82688459,21.54421584]])
dist5=np.array([
#[1286.42895264,708.57104736,5.06579482],
#[1255.41861241,739.58138759,43.83398451],
#[1235.41194129,759.58805871,100.],
#[1211.40393596,783.59606404,100.],
#[1187.39593062,807.60406938,100.],
[1127.37591728,867.62408272,26.5211904 ],
[1040.34689793,954.65310207,29.78267239],
[963.32121414,1031.67878586,20.9704541 ],
[881.29386258,1113.70613742,21.54559833],
[828.27618412,1166.72381588,13.77905421],
#[776.25883923,1218.74116077,31.49530703],
#[760.76287394,1234.23712606,100.],
[742.24749833,1252.75250167,9.13887399],
[690.23015344,1304.76984656,12.99769612],
[623.2078052,1371.7921948 ,5.47049135]
])
dist6=np.array([
#[1286.42895264,709.57104736,100.],
#[1224.40827218,771.59172782,19.5261466 ],
[1129.37658439,866.62341561,23.50962069],
#[1096.36557705,899.63442295,7.7777216 ],
[1044.34823215,951.65176785,30.93730277],
[963.32121414,1032.67878586,16.50455004],
[882.29419613,1113.70580387,13.06961478],
#[844.35340617,1151.64659383,100.],
[829.27651768,1166.72348232,12.26775414],
[741.24716478,1254.75283522,12.14586008],
[687.22915277,1308.77084723,21.23289111],
[618.20613742,1377.79386258,35.03156749],
[558.18612408,1437.81387592,8.17371028],
[519.17311541,1476.82688459,5.0074643 ],
[495.16511007,1500.83488993,30.56534916],
[471.15710474,1524.84289526,100.],
[447.1490994,1548.8509006 ,16.38019244],
[403.13442295,1592.86557705,11.91840388]
])

dist_corrected=np.array([
	[0,722,20],
	[0,806,49],
	[0,897,13],
	[0,960,29],
	[0,1097,13],
	[0,1162,14],
	[0,1274,15],
	[0,1322,14]])
t=0.004
B=0.7
errB=0.001

magneton, magnetonerr=err(B,errB,dist_corrected,h,c,t)
print(magneton)
print(magnetonerr)

